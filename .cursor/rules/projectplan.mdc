---
description: 
globs: 
alwaysApply: true
---
. Overzicht in Ã©Ã©n oogopslag

Clone het project of maak het aan met de CursorÂ Project Rules.

Installeer dependencies (pip install -r requirements.txt).

Voeg je Community APIâ€‘key toe (envâ€‘var of .env).

Run streamlit run streamlit_app.py.

Upload een PDF <â€¯10â€¯MB â†’ zie gemaskeerd resultaat en download.

âœ”ï¸Â Klaar! De rest van deze gids geeft alle achterÂ­grond, tips en probleemÂ­oplossing.

2. Vereisten

Stap

Software

Versieâ€‘indicatie

Installâ€‘hint

1

Python

3.10Â â€“Â 3.12

pyenv install 3.12

2

pip / venv

recent

python -m venv venv && source venv/bin/activate

3

Git

any

brew install git

4

(Opt.) Docker

24+

voor onâ€‘prem variant

3. APIâ€‘sleutel & limieten

Eigenschap

Community key

Calls per minuut

10

Calls per dag

75

Max. PDFâ€‘grootte

10Â MB

# Zet je sleutel als envâ€‘var
export PRIVATEAI_KEY="pk_live_â€¦"
# (optioneel) eigen endpoint â€“ standaard is community
export PRIVATEAI_URL="https://api.private-ai.com/community/v4"

â—Â Streamlit blokkeert uploads >Â 200Â MB, maar de APIâ€limiet is 10Â MB. De app valideert dit vooraf zodat je geen call verspilt.

4. Projectstructuur (gegenereerd door Cursor)

privateai-redact-demo/
â”œâ”€ streamlit_app.py        # hoofdâ€‘UI + APIâ€‘call
â”œâ”€ requirements.txt        # packages
â”œâ”€ .env.example            # voorbeeldÂ env
â”œâ”€ tests/
â”‚  â””â”€ test_smoke.py        # minimale importâ€‘test
â”œâ”€ scripts/                # hulpscripts
â”‚  â”œâ”€ run.sh               # .env inladen + run
â”‚  â”œâ”€ lint.sh              # Ruff check
â”‚  â””â”€ format.sh            # Ruff format
â”œâ”€ .github/workflows/ci.yml# CIâ€‘pipeline
â””â”€ README.md               # beknopte uitleg

5. Stapâ€‘voorâ€‘stap installatie

Repository aanmaken

# optieÂ AÂ â€“ via Cursor Rules (aanbevolen)
# 1) Open Cursor â†’ Create Project from Rules â†’ plak JSON

# optieÂ BÂ â€“ clone kantâ€‘enâ€‘klaar repo
git clone https://github.com/yourâ€‘org/privateai-redact-demo.git
cd privateai-redact-demo

Virtuele omgeving

python -m venv venv
source venv/bin/activate

Dependencies

pip install -r requirements.txt

APIâ€‘sleutel instellen

cp .env.example .env        # vul sleutel in of gebruik export
# of
export PRIVATEAI_KEY="pk_live_â€¦"

Ontwikkelserver starten

streamlit run streamlit_app.py
# of via Cursorâ€‘task (âŒ˜â‡§P â†’ Tasks: RunÂ Task â†’ DevÂ server)

PDF uploaden

Ga naar localhost:8501.

Kies een PDF â‰¤â€¯10Â MB.

Klik Redacteer en wacht ~1â€‘6â€¯sec.

Download of bekijk inline.

6. Belangrijkste codeâ€‘fragmenten uitgelegd

# ðŸŽ¯ streamlit_app.py â€“ upload handler
import base64, os, requests, streamlit as st

API_URL = os.getenv("PRIVATEAI_URL", "https://api.private-ai.com/community/v4")
API_KEY = os.getenv("PRIVATEAI_KEY")
HEADERS  = {"x-api-key": API_KEY}

file = st.file_uploader("Upload een PDF", type=["pdf"])
if file:
    if file.size > 10 * 1024 * 1024:
        st.error("Bestand > 10Â MB â€“ verklein of kies een ander document.")
        st.stop()

    data_b64 = base64.b64encode(file.getvalue()).decode()
    payload  = {"file": {"data": data_b64, "content_type": "application/pdf"}}

    with st.spinner("Bezig met lakken â€¦"):
        r = requests.post(f"{API_URL}/process/files/base64", json=payload, headers=HEADERS, timeout=120)

    if r.ok:
        red_b64 = r.json()["processed_file"]
        red_pdf = base64.b64decode(red_b64)
        st.download_button("Download gelakte PDF", red_pdf, file_name=f"redacted_{file.name}")
        st.pdf(red_pdf)  # preview
    else:
        st.error(f"APIâ€‘fout: {r.status_code} â€“ {r.text}")

Wat gebeurt er?

Het bestand wordt base64â€‘geÃ«ncodeerd (communityâ€‘eis).

/process/files/base64 retourneert ook base64.

Streamlit decodeert en biedt als downloadâ€‘knop + inline PDFâ€‘viewer.

7. Lint, format & tests

# statisch analyseren
make lint   # alias: ruff check .
# automatische format
make format # alias: ruff format .
# tests draaien
make test   # alias: pytest -q

âœ…Â Proâ€‘tip: voeg preâ€‘commit hooks toe om ruff automatisch te draaien bij elke commit.

8. CIÂ /Â CD

GitHubÂ Action ci.yml draait bij elke push of pull request:

Checkâ€‘out repo

Setâ€‘up Python 3.11

Install dependencies

Ruff lint

Pytest

Je kunt eenvoudig een stap toevoegen om beelden naar DockerÂ Hub te pushen of eenÂ Streamlit Cloud deploy te triggeren.

9. Veelvoorkomende fouten & oplossingen

Symptoom

Mogelijke oorzaak

Fix

429 Too Many Requests

>â€¯10â€¯requests/min of >â€¯75â€¯perâ€¯dag

Wacht 60â€¯sec of gebruik 2e sleutel

400 File too large

PDFÂ >Â 10â€¯MB

comprimeer (bv.Â gs -sDEVICE=pdfwrite -dPDFSETTINGS=/ebook â€¦)

connect timeout

Langzame upload >Â 120â€¯sec

vergroot timeout of gebruik sneller internet

Streamlit whiteâ€‘page

Envâ€‘var niet gezet

check .env of echo $PRIVATEAI_KEY

10. Volgende stappen

DOCXâ€‘support: vervang type=["pdf"] door type=["pdf", "docx"] en stuur naar hetzelfde endpoint.

Onâ€‘prem Privateâ€‘AI: vervang PRIVATEAI_URL door je interne host en laat base64â€‘upload weg (gebruik /process/files/uri).

Rateâ€‘limit throttle: queue requests clientâ€‘side of gebruik RedisÂ RQ voor serverâ€‘side batching.

DockerÂ Compose: draai Streamlit + nginx + (optioneel) Privateâ€‘AI container achter Ã©Ã©n reverse proxy.

Security: serve PDFâ€™s via tijdelijke S3 presigned URLâ€™s i.p.v. direct in mem.


